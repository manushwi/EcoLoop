<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoLoop - Upload Page</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/upload.css">
  <link rel="stylesheet" href="../css/style.css">
  <script src="../js/upload.js"></script>
</head>

<body>

  <div class="headerdiv">
    <header>
      <a href="/" class="back-btn" id="backBtn">‚Üê Back to Home</a>
    </header>
  </div>

  <main>
    <div class="scanner-card">
      <h2>Scan Your Item</h2>
      
      <p>Take a photo or upload an image of the item you want to dispose of</p>

      <div class="camera-box">
        <div class="camera-icon">‚åû ‚åù</div>
        <p>Camera preview will appear here</p>
      </div>

      <div class="button-group">
        <a href="#">‚õ∂ „Ö§Take photo</a>
        <b href="#">üîó„Ö§upload Image</b>
      </div>
      <div class="tips">
        <h3>‚åû ‚åù„Ö§Scanning Tips</h3>
        <ul>
          <li>Ensure good lighting</li>
          <li>Include any labels or barcodes</li>
          <li>Show the entire item clearly</li>
          <li>Avoid shadows and reflections</li>
        </ul>
      </div>
    </div>
  </main>

  <!-- Authentication checking -->
  <script>
    // Check authentication status on page load
    async function checkAuthStatus() {
      try {
        const response = await fetch('/api/auth/status', {
          credentials: 'include'
        });
        const result = await response.json();

        if (!result.authenticated) {
          //   User is not authenticated, redirect to login
          window.location.href = '/login';
          return;
        }

        // User is authenticated, update back button to maintain session
        const backBtn = document.getElementById('backBtn');
        if (backBtn) {
          backBtn.addEventListener('click', function (e) {
            e.preventDefault();
            //     // Navigate back to home page while maintaining authentication
            window.location.href = '/';
          });
        }

        // Handle logout button
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', handleLogout);
        }

      } catch (error) {
        console.log('Auth check failed, redirecting to login');
        window.location.href = '/login';
      }
    }

    // Handle logout
    async function handleLogout() {
      try {
        const response = await fetch('/api/auth/logout', {
          method: 'POST',
          credentials: 'include'
        });

        const result = await response.json();

        if (result.success) {
          // Redirect to home page after logout
          window.location.href = '/';
        } else {
          console.error('Logout failed:', result.message);
        }
      } catch (error) {
        console.error('Logout error:', error);
        // Redirect to home page even if logout fails
        window.location.href = '/';
      }
    }

    // Check auth status when page loads
    checkAuthStatus();

    // Also check auth status when page becomes visible (for back button navigation)
    document.addEventListener('visibilitychange', function () {
      if (!document.hidden) {
        checkAuthStatus();
      }
    });

    // Check auth status when page gains focus (for back button navigation)
    window.addEventListener('focus', function () {
      checkAuthStatus();
    });

    // Check auth status when page is shown (for browser back/forward)
    window.addEventListener('pageshow', function (event) {
      // Check if page is loaded from cache (back/forward navigation)
      if (event.persisted) {
        checkAuthStatus();
      }
    });

  </script>
</body>

</html>