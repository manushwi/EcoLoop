<!doctype html>
<html lang="en">
<head>

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>EcoLoop — Glass Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Link to external CSS -->
<link rel="stylesheet" href="../css/dashboard.css" />
<link rel="stylesheet" href="../css/style.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width= , initial-scale=1.0">
    <title>dashboard</title>

</head>
<body>
  <!-- Navigation Bar -->
  <div class="navdiv">
    <nav>
      <div class="logo">Ecoloop</div>
      <div class="nav-links" id="nav-links">
        <button id="logoutBtn" class="logout-btn">Logout</button>
      </div>
    </nav>
  </div>

  <div class="wrap">

    <!-- Header -->
    <header class="topbar">
      <div class="left">
        <button class="btn-back" onclick="history.back()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M15 18L9 12L15 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="title-wrap">
          <div class="title">Your Impact Dashboard</div>
          <div class="subtitle">EcoLoop · Track your circular actions</div>
        </div>
      </div>

      <button class="btn-scan">Scan New Item</button>
    </header>

    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-num" id="stat-items">(No. of item rescued)</div>
        <div class="stat-label">Items Rescued</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="stat-co2">(wgt. of carbon saved)</div>
        <div class="stat-label">CO₂ Saved</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="stat-chal">(no.of challenges done)</div>
        <div class="stat-label">Challenges</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="stat-rank">(#user rank)</div>
        <div class="stat-label">Community Rank</div>
      </div>
      <div class="stat-card">
        <div class="stat-num" id="stat-streak">#</div>
        <div class="stat-label">Day Streak</div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs" role="tablist">
      <button class="tab active" data-tab="overview">Overview</button>
      <button class="tab" data-tab="challenges">Challenges</button>
      <button class="tab" data-tab="badges">Badges</button>
      <button class="tab" data-tab="history">History</button>
    </div>

    <!-- Overview -->
    <section id="overview" class="panel" role="tabpanel">
      <div class="carbon-row">
        <div class="carbon-left">
          <div class="carbon-value" id="carbon-value">(wgt. of carbon saved)</div>
          <div class="carbon-sub">Your environmental contribution</div>

          <div class="progress" aria-hidden="true"><i id="carbon-fill" style="width: 0%;"></i></div>
          <div style="margin-top:8px;color:var(--muted)">Goal: (wgt. of carbon saved)  — <strong style="color:#fff">(wgt. of carbon saved) / (wgt. of carbon goal )</strong></div>
        </div>

        <div class="carbon-right">
          <div style="font-weight:800; font-size:18px;">(carbon %)</div>
          <div style="font-size:13px;color:var(--muted); margin-top:6px;">of monthly goal</div>
        </div>
      </div>

      <div style="height:14px"></div>

      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:800">Recent Activity</div>
        <div style="color:var(--muted); font-size:13px;">Your latest circular actions</div>
      </div>

      <div class="activity-list">
        <!-- Example activities commented out, add your data here -->
      </div>
    </section>

    <!-- Challenges -->
    <section id="challenges" class="panel" role="tabpanel" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:800">Challenges</div>
        <div style="color:var(--muted)">Active & upcoming</div>
      </div>

      <div style="height:12px"></div>

      <div class="challenge-row">
        <!-- Add challenges here -->
      </div>
    </section>

    <!-- Badges -->
    <section id="badges" class="panel" role="tabpanel" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:800">Achievement Badges</div>
        <div style="color:var(--muted)">Unlock by completing actions</div>
      </div>

      <div class="badges">
        <!-- Add badges here -->
      </div>
    </section>

    <!-- History -->
    <section id="history" class="panel" role="tabpanel" style="display:none;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <div style="font-weight:800">Action History</div>
        <div style="color:var(--muted)">Complete log of circular actions</div>
      </div>

      <!-- Add history items here -->
    </section>

  </div>

  <!-- Link to external JS -->
  <script src="../js/dashboard.js"></script>

  <!-- Logout functionality -->
  <script>
    // Check authentication status on page load
    async function checkAuthStatus() {
      try {
        const response = await fetch('/api/auth/status', {
          credentials: 'include'
        });
        const result = await response.json();
        
        if (!result.authenticated) {
          window.location.href = '/login';
        }
      } catch (error) {
        console.log('Auth check failed, redirecting to login');
        window.location.href = '/login';
      }
    }

    // Handle logout
    async function handleLogout() {
      try {
        const response = await fetch('/api/auth/logout', {
          method: 'POST',
          credentials: 'include'
        });
        
        const result = await response.json();
        
        if (result.success) {
          // Redirect to home page after logout
          window.location.href = '/';
        } else {
          console.error('Logout failed:', result.message);
        }
      } catch (error) {
        console.error('Logout error:', error);
        // Even if logout fails, redirect to home page
        window.location.href = '/';
      }
    }

    // Add event listener to logout button
    document.getElementById('logoutBtn').addEventListener('click', handleLogout);

    // Check auth status when page loads
    checkAuthStatus();
  </script>

  <style>
    /* Custom styling for logout button */
    .logout-btn {
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 20px;
      border: 1px solid #1ab653;
      background: rgba(0, 128, 0, 0.53);
      color: white;
      transition: 0.3s ease;
      font-size: clamp(12px, 2.5vw, 14px);
      cursor: pointer;
      font-family: inherit;
    }

    .logout-btn:hover {
      background: rgba(8, 174, 66, 0.4);
    }

    /* Adjust dashboard layout to account for navbar */
    .wrap {
      margin-top: 100px;
    }

    /* Ensure navbar is above other content */
    .navdiv {
      z-index: 1000;
    }
  </style>
</body>
</html>
